# 恩奇都 —— 连击与范围控制兼具
role "Enkidu" id "lancer_enkidu" {
  description "\n恩奇都（Enkidu）。机制：\n- 天赋1：续航与法抗——每回合回蓝回生，并逐回合法抗提升（有上限）。\n- 天赋2：近战连击——与近身敌人交战（5×5，等价曼哈顿≤2）时触发双段打击。\n- 一技能「双链」：两段物理打击，每段 40% 概率无视护甲、40% 概率施加定身，并提升机动（速度 +1）。\n- 二技能「广域扫荡」：对至多两名敌人并行造成伤害，自身 +1 攻击并小幅回血。\n- 宝具「天之锁」：点选 7×7 外一点，对以该点为中心 5×5 范围敌人重复 6 次 1 点伤害，并施加定身（封印至第 3 回合）。\n";

  vars {
    "hp" = 34;
    "max_hp" = 34;
    "mp" = 5.0;
    "atk" = 7;
    "def" = 5;
    "mdef" = 6;
    "range" = 1;
    "speed" = 3;

    # 被动续航：回蓝回生
    "mp_regen_per_turn" = 0.5;
    "hp_regen_per_turn" = 1;
    # 法抗逐回合提升（上限 0.6）
    "resist_magic" = 0.1;
    "per_turn_add:resist_magic" = 0.05;
    "per_turn_max:resist_magic" = 0.6;

    # 近身连击触发（5×5 等价曼哈顿≤2）
    "extra_strikes_range" = 2;
    "extra_strikes_count" = 2;
  }

  tags { "lancer" }

  skills {
    # 基础攻击（与 attack 一致）
    skill "Basic Attack" {
      range 1; targeting enemies;
      deal physical 6 damage to target from caster;
    }

    # 续航按钮：小幅自疗（回蓝由被动提供）
    skill "Nature's Blessing" {
      range 0; targeting self; cooldown 1;
      heal 1 to caster;
      set unit(caster) var "mp_regen_per_turn" = var "mp_regen_per_turn" of caster + 0;
    }

    # 一技能「双链」：两段打击；每段 40% 无视护甲、40% 定身；机动 +1
    skill "Twin Chains" {
      range 3; targeting enemies; cooldown 2;
      # 第一段
      chance 40% then { deal physical 6 damage to target from caster ignore defense 100% } else { deal physical 6 damage to target from caster };
      chance 40% then { add tag "rooted" to target; set unit(target) var "rooted_turns" = 1 };
      # 第二段
      chance 40% then { deal physical 6 damage to target from caster ignore defense 100% } else { deal physical 6 damage to target from caster };
      chance 40% then { add tag "rooted" to target; set unit(target) var "rooted_turns" = 1 };
      # 机动 +1
      set unit(caster) var "speed" = var "speed" of caster + 1;
      consume mp = 1.0;
    }

    # 二技能「广域扫荡」：并行打击两名敌人，自身 +1 攻击并小幅回血
    skill "Wide Sweep" {
      range 3; cooldown 3; targeting enemies;
      # 并行命中两名敌人
      for each enemies in range 3 of caster limit 2 in parallel do {
        deal physical 6 damage to it from caster
      };
      # 强化：+1 攻击并小幅自疗
      set unit(caster) var "atk" = var "atk" of caster + 1;
      heal 1 to caster;
      consume mp = 1.5;
    }

    # 宝具「天之锁」：点选坐标，对半径 2（约 5×5）范围敌人多段打击并定身（封印到第 3 回合）
    skill "Chains of Heaven" {
      range 5; min_range 4; targeting tile; cooldown 5; sealed_until day 3;
      for each enemies in range 2 of point in parallel do {
        repeat 6 times {
          deal 1 damage to it
        };
        add tag "rooted" to it;
        set unit(it) var "rooted_turns" = 1
      };
      consume mp = 2.5;
    }
  }
}
